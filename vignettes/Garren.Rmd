---
title: "Garren"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Garren}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


#Libraries Used
```{r setup}
library(wrta)
library(sf)
library(dplyr)
library(rgdal)
```

# Reading in Files
```{r}
stops <- read_sf(dsn = "Active_WRTA_Bus_Stops_Aug2020.shp", package = "wrta", 
                 layer = "SHAPEFILE")
  (system.file("Active_WRTA_Bus_Stops_Aug2020.shp", package = "wrta")) %>% 
  st_read() 

routes <- read_sf(dsn = "Read_In/tl_2018_25027_roads.shp", package = "wrta",
                  layer = "SHAPEFILE")

 %>% plot()

ridership <- (system.file("Read_In/Weekday_ridership.xlsx", package = "wrta")) %>% st_read()
roads <- read_sf(dsn = "Read_In/tl_2018_25027_roads", package = "wrta", 
                 layer = "SHAPEFILE") %>% st_read
```

```{r}
ridership <- system.file("extdata/Weekday_ridership.xlsx", package = "wrta") %>% 
  st_read() 
stops <- system.file("extdata/county.shp", package = "wrta") %>% st_read()
```

#Locally Stored Version
```{r}
ridership <- ("/Users/garrenkalter/Desktop/wrta/Read_In/Weekday_ridership.xlsx") %>% 
  st_read()

routes <- ("/Users/garrenkalter/Desktop/wrta/Read_In/WRTA\ August\ 2020/Active_WRTA_Routes_Aug2020.shp") %>% st_read() %>% st_zm()

roads <- ("/Users/garrenkalter/Desktop/wrta/Read_In/tl_2018_25027_roads/tl_2018_25027_roads.shp") %>% st_read() %>% plot()

worcester_ct <- ("/Users/garrenkalter/Desktop/wrta/Read_In/tl_2017_25027_faces/tl_2017_25027_faces.shp") %>% st_read() %>% plot()

stops <- ("/Users/garrenkalter/Desktop/wrta/Read_In/WRTA\ August\ 2020/Active_WRTA_Bus_Stops_Aug2020.shp") %>% st_read

```

# Join
```{r}
#Identifying whether variables Match
routes$Bus_Route %in% ridership$ROUTE

#completing a join via coercion
full_join(as_tibble(ridership), routes, by = c("ROUTE" = "BusRoute"))

```


# Map Categorizing Routes
```{r}
 # category map

ridership %>% 
  mutate(WKDAY_RIDERS_cat = ifelse(WKDAY_RIDERS > 100000, "high", WKDAY_RIDERS_cat),  
          WKDAY_RIDERS_cat = ifelse(between(WKDAY_RIDERS, 10000, 99999), "medium", WKDAY_RIDERS_cat),
        WKDAY_RIDERS_cat = ifelse(WKDAY_RIDERS < 10000, "low", WKDAY_RIDERS_cat),
        WKDAY_RIDERS_cat = ifelse(WKDAY_RIDERS, "No Route", WKDAY_RIDERS_cat)) %>% 
    ggplot() + geom_sf(aes(fill = yld_cat))
```

# Map Showcasing Routes above Maximum Allowable Subsidy

```{r}
> districts2 %>% 
+   mutate(yld_cat = ifelse(yield > , "high", "other") , 
+          yld_cat = ifelse(between(yield, 3.5, 4.5), "medium", yld_cat),
+          yld_cat = ifelse(yield < 3.5, "low", yld_cat)) %>% 
+   ggplot() + geom_sf(aes(fill = yld_cat))
```

